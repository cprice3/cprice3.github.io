<!DOCTYPE html>
<html>
<head>
    <title>Line Graph</title>
    <title>Google Sheets Line Graph</title>

    <script src="https://www.gstatic.com/charts/loader.js"></script>
    
    <script>
        google.charts.load('current', {
            'packages': ['corechart', 'controls']
        });
        google.charts.setOnLoadCallback(initialize);

        function initialize() {
            fetchDataAndDrawCharts();

            // Refresh the data and charts every 60 seconds
            setInterval(fetchDataAndDrawCharts, 60000);
        }

        function fetchDataAndDrawCharts() {
            var queryStringTemp = encodeURIComponent('select B, C limit 400 label C "Temperature (Â°C)"');
            var queryStringHumidity = encodeURIComponent('select B, D limit 400 label D "Humidity (%)"');

            var queryTemp = new google.visualization.Query(
                'https://docs.google.com/spreadsheets/d/1lkBDiWV8zLEw5IP6J71npqJSLwpoK9ZyNYFPk0W-hIg/gviz/tq?gid=0&headers=1&tq=' + queryStringTemp
            );
            var queryHumidity = new google.visualization.Query(
                'https://docs.google.com/spreadsheets/d/1lkBDiWV8zLEw5IP6J71npqJSLwpoK9ZyNYFPk0W-hIg/gviz/tq?gid=0&headers=1&tq=' + queryStringHumidity
            );

            queryTemp.send(handleTemperatureQueryResponse);
            queryHumidity.send(handleHumidityQueryResponse);
        }

        function handleTemperatureQueryResponse(response) {
            if (response.isError()) {
                alert('Error in temperature query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }

            var data = response.getDataTable();
            displayCharts(data);
        }

        function handleHumidityQueryResponse(response) {
            if (response.isError()) {
                alert('Error in humidity query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }

            var data = response.getDataTable();
            displayCharts(data);
        }

        function displayCharts(data) {
            var options = {
                curveType: 'function',
                legend: {
                    position: 'bottom'
                }
            };

            var dashboard = new google.visualization.Dashboard(document.getElementById('dashboard'));

            var temperatureChart = new google.visualization.ChartWrapper({
                chartType: 'LineChart',
                containerId: 'temperature-chart',
                options: Object.assign({}, options, {
                    title: 'Temperature Data'
                })
            });

            var humidityChart = new google.visualization.ChartWrapper({
                chartType: 'LineChart',
                containerId: 'humidity-chart',
                options: Object.assign({}, options, {
                    title: 'Humidity Data'
                })
            });

            dashboard.bind([temperatureChart, humidityChart]);
            dashboard.draw(data);
        }
    </script>
</head>
<nav>
    <a href="index.html">Go Home Page</a>
</nav>
<body>   
    <div id="dashboard">
        <div id="temperature-chart" style="width: 100%; height: 475px;"></div>
        <div id="humidity-chart" style="width: 100%; height: 475px;"></div>
    </div>
</body>
