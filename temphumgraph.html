html
Copy code
<!DOCTYPE html>
<html>
<head>
    <title>Google Sheets Line Graph</title>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        google.charts.load('current', {
            'packages': ['corechart']
        });
        google.charts.setOnLoadCallback(initialize);

        function initialize() {
            fetchDataAndDrawCharts();

            // Refresh the data and charts every 60 seconds
            setInterval(fetchDataAndDrawCharts, 60000);
        }

        function fetchDataAndDrawCharts() {
            var startDate = new Date();
            startDate.setHours(startDate.getHours() - 12); // Substract 12 hours from current time
            var startTimestamp = startDate.toISOString();

            var queryStringTemp = encodeURIComponent("select B, C where B >= timestamp '" + startTimestamp + "' limit 400 label C 'Temperature (Â°C)'");
            var queryStringHumidity = encodeURIComponent("select B, D where B >= timestamp '" + startTimestamp + "' limit 400 label D 'Humidity (%)'");

            var queryTemp = new google.visualization.Query(
                'https://docs.google.com/spreadsheets/d/1lkBDiWV8zLEw5IP6J71npqJSLwpoK9ZyNYFPk0W-hIg/gviz/tq?gid=0&headers=1&tq=' + queryStringTemp
            );
            var queryHumidity = new google.visualization.Query(
                'https://docs.google.com/spreadsheets/d/1lkBDiWV8zLEw5IP6J71npqJSLwpoK9ZyNYFPk0W-hIg/gviz/tq?gid=0&headers=1&tq=' + queryStringHumidity
            );

            queryTemp.send(handleTemperatureQueryResponse);
            queryHumidity.send(handleHumidityQueryResponse);
        }

        function handleTemperatureQueryResponse(response) {
            if (response.isError()) {
                alert('Error in temperature query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }

            var data = response.getDataTable();
            displayTemperatureChart(data);
        }

        function handleHumidityQueryResponse(response) {
            if (response.isError()) {
                alert('Error in humidity query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
                return;
            }

            var data = response.getDataTable();
            displayHumidityChart(data);
        }

        function displayTemperatureChart(data) {
            var options = {
                title: 'Temperature Data',
                curveType: 'function',
                legend: {
                    position: 'bottom'
                },
                hAxis: {
                    format: 'MMM d, HH:mm' // Display day and time on the x-axis
                }
            };

            var chart = new google.visualization.LineChart(document.getElementById('temperature-chart'));
            chart.draw(data, options);
        }

        function displayHumidityChart(data) {
            var options = {
                title: 'Humidity Data',
                curveType: 'function',
                legend: {
                    position: 'bottom'
                },
                hAxis: {
                    format: 'MMM d, HH:mm' // Display day and time on the x-axis
                }
            };

            var chart = new google.visualization.LineChart(document.getElementById('humidity-chart'));
            chart.draw(data, options);
        }
    </script>
</head>
<body>
    <div id="chart" style="width: 100%; height: 400px;"></div>
    <div id="temperature-chart" style="width: 100%; height: 400px;"></div>
    <div id="humidity-chart" style="width: 100%; height: 400px;"></div>
</body>
</html>
